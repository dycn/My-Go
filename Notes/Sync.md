### sync包 ###

##### sync.Once #####
1. 概念
    - Go语言提供的一种机制, 用于执行一次性操作, 通常用于并发安全的执行一次任务。
    - 使用了非常经典的编程范式-快慢路径

2. 快慢路径
    - 慢路径
        - 一种更加保守、安全但性能较低的解决方案。代码会使用互斥锁等同步原语来确保并发安全性。
        - 会导致性能开销, 因为它需要在多个线程之间进行显式的同步和互斥操作, 以确保数据的一致性和正确性。
    - 快路径
        - 一种更加高效但风险较高的解决方案。代码会使用原子操作等非阻塞的同步机制来尽量减少同步开销。
        - 会更高效, 因为它避免了显式的同步和互斥操作, 但在某些情况下会导致竞态条件或者数据不一致的问题。
3. 实现
    - 在官方实现中, 需要执行完D传入的初始化函数 f() 然后再设置完成标记 done.Store(1)
    - 如果先设置完成标记, 再执行函数, 会导致其他线程在获取标记时判断为已初始化完, 去使用初始化过的资源, 而实际上初始化函数并没执行完

```官方实现
type Once struct {
	done atomic.Uint32
	m    Mutex
}

func (o *Once) Do(f func()) {
	if o.done.Load() == 0 {
		o.doSlow(f)
	}
}

func (o *Once) doSlow(f func()) {
	o.m.Lock()
	defer o.m.Unlock()
	if o.done.Load() == 0 {
		defer o.done.Store(1)
		f()
	}
}
```